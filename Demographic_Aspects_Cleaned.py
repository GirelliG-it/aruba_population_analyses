{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 141,
   "id": "00541bf9-b1d2-414a-ba58-666837aeb403",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "── df_long ──\n",
      "                  Indicator Measurement  Year     Value\n",
      "0                     Males    Absolute  2015   51309.0\n",
      "1                   Females    Absolute  2015   57326.0\n",
      "2          Total population    Absolute  2015  108635.0\n",
      "3                 Sex ratio         NaN  2015      89.5\n",
      "4         Pop. per km2 land    Absolute  2015     604.0\n",
      "..                      ...         ...   ...       ...\n",
      "94  Pop. 60 years and older           %  2023      26.3\n",
      "95                    Males       Years  2023      41.0\n",
      "96                  Females       Years  2023      43.8\n",
      "97                    Total       Years  2023      42.5\n",
      "98            Net migration    Absolute  2023     372.0\n",
      "\n",
      "[99 rows x 4 columns]\n",
      "\n",
      "── df_counts (headcounts only) ──\n",
      "           Indicator Measurement  Year   Value\n",
      "0              Males    Absolute  2015   51309\n",
      "1            Females    Absolute  2015   57326\n",
      "2   Total population    Absolute  2015  108635\n",
      "7              Males       Years  2015      38\n",
      "8            Females       Years  2015      40\n",
      "11             Males    Absolute  2016   51462\n",
      "12           Females    Absolute  2016   57357\n",
      "13  Total population    Absolute  2016  108818\n",
      "18             Males       Years  2016      38\n",
      "19           Females       Years  2016      40\n",
      "22             Males    Absolute  2017   51399\n",
      "23           Females    Absolute  2017   57253\n",
      "24  Total population    Absolute  2017  108651\n",
      "29             Males       Years  2017      38\n",
      "30           Females       Years  2017      41\n",
      "33             Males    Absolute  2018   51512\n",
      "34           Females    Absolute  2018   57652\n",
      "35  Total population    Absolute  2018  109164\n",
      "40             Males       Years  2018      38\n",
      "41           Females       Years  2018      41\n",
      "44             Males    Absolute  2019   51515\n",
      "45           Females    Absolute  2019   57726\n",
      "46  Total population    Absolute  2019  109241\n",
      "51             Males       Years  2019      39\n",
      "52           Females       Years  2019      42\n",
      "55             Males    Absolute  2020   50930\n",
      "56           Females    Absolute  2020   57002\n",
      "57  Total population    Absolute  2020  107932\n",
      "62             Males       Years  2020      40\n",
      "63           Females       Years  2020      42\n",
      "66             Males    Absolute  2021   50664\n",
      "67           Females    Absolute  2021   56804\n",
      "68  Total population    Absolute  2021  107468\n",
      "73             Males       Years  2021      40\n",
      "74           Females       Years  2021      43\n",
      "77             Males    Absolute  2022   50440\n",
      "78           Females    Absolute  2022   56712\n",
      "79  Total population    Absolute  2022  107152\n",
      "84             Males       Years  2022      41\n",
      "85           Females       Years  2022      43\n",
      "88             Males    Absolute  2023   50559\n",
      "89           Females    Absolute  2023   57007\n",
      "90  Total population    Absolute  2023  107566\n",
      "95             Males       Years  2023      41\n",
      "96           Females       Years  2023      44\n",
      "\n",
      "── df_relative (ratios, density, etc.) ──\n",
      "                    Indicator Measurement  Year   Value\n",
      "3                   Sex ratio         NaN  2015    89.5\n",
      "4           Pop. per km2 land    Absolute  2015   604.0\n",
      "5   Pop. 14 years and younger           %  2015    18.9\n",
      "6     Pop. 60 years and older           %  2015    18.7\n",
      "9                       Total       Years  2015    38.9\n",
      "10              Net migration    Absolute  2015   900.0\n",
      "14                  Sex ratio         NaN  2016    89.7\n",
      "15          Pop. per km2 land    Absolute  2016   605.0\n",
      "16  Pop. 14 years and younger           %  2016    18.7\n",
      "17    Pop. 60 years and older           %  2016    19.4\n",
      "20                      Total       Years  2016    39.2\n",
      "21              Net migration    Absolute  2016  -293.0\n",
      "25                  Sex ratio         NaN  2017    89.8\n",
      "26          Pop. per km2 land    Absolute  2017   604.0\n",
      "27  Pop. 14 years and younger           %  2017    18.6\n",
      "28    Pop. 60 years and older           %  2017    20.1\n",
      "31                      Total       Years  2017    39.5\n",
      "32              Net migration    Absolute  2017  -698.0\n",
      "36                  Sex ratio         NaN  2018    89.3\n",
      "37          Pop. per km2 land    Absolute  2018   606.0\n",
      "38  Pop. 14 years and younger           %  2018    18.3\n",
      "39    Pop. 60 years and older           %  2018    20.9\n",
      "42                      Total       Years  2018    39.8\n",
      "43              Net migration    Absolute  2018    66.0\n",
      "47                  Sex ratio         NaN  2019    89.2\n",
      "48          Pop. per km2 land    Absolute  2019   607.0\n",
      "49  Pop. 14 years and younger           %  2019    18.1\n",
      "50    Pop. 60 years and older           %  2019    21.7\n",
      "53                      Total       Years  2019    40.2\n",
      "54              Net migration    Absolute  2019  -436.0\n",
      "58                  Sex ratio         NaN  2020    89.3\n",
      "59          Pop. per km2 land    Absolute  2020   600.0\n",
      "60  Pop. 14 years and younger           %  2020    17.0\n",
      "61    Pop. 60 years and older           %  2020    23.5\n",
      "64                      Total       Years  2020    41.2\n",
      "65              Net migration    Absolute  2020 -1617.0\n",
      "69                  Sex ratio         NaN  2021    89.2\n",
      "70          Pop. per km2 land    Absolute  2021   597.0\n",
      "71  Pop. 14 years and younger           %  2021    16.6\n",
      "72    Pop. 60 years and older           %  2021    24.5\n",
      "75                      Total       Years  2021    41.6\n",
      "76              Net migration    Absolute  2021  -519.0\n",
      "80                  Sex ratio         NaN  2022    88.9\n",
      "81          Pop. per km2 land    Absolute  2022   595.0\n",
      "82  Pop. 14 years and younger           %  2022    16.1\n",
      "83    Pop. 60 years and older           %  2022    25.5\n",
      "86                      Total       Years  2022    42.1\n",
      "87              Net migration    Absolute  2022  -352.0\n",
      "91                  Sex ratio         NaN  2023    88.7\n",
      "92          Pop. per km2 land    Absolute  2023   598.0\n",
      "93  Pop. 14 years and younger           %  2023    15.6\n",
      "94    Pop. 60 years and older           %  2023    26.3\n",
      "97                      Total       Years  2023    42.5\n",
      "98              Net migration    Absolute  2023   372.0\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "# =============================================================\n",
    "# 1. LOAD RAW DATA\n",
    "# =============================================================\n",
    "df1 = pd.read_excel(\n",
    "    \"/home/ggirelli/Documents/DataAnalysis/Datasets/Official_Open-Datasets_Aruba_CBS/Demographic-aspects-2023.xlsx\",\n",
    "    header=1\n",
    ")\n",
    "\n",
    "# =============================================================\n",
    "# 2. CLEAN: strip whitespace, drop problematic row\n",
    "# =============================================================\n",
    "df1[\"Key Demographic aspects\"] = df1[\"Key Demographic aspects\"].astype(str).str.strip()\n",
    "df1 = df1[df1[\"Key Demographic aspects\"] != \"Average age\"].copy()\n",
    "\n",
    "# =============================================================\n",
    "# 3. MELT wide → long and rename columns\n",
    "# =============================================================\n",
    "df_long = (\n",
    "    df1.melt(\n",
    "        id_vars=[\"Key Demographic aspects\", \"Unit\"],\n",
    "        var_name=\"Year\",\n",
    "        value_name=\"Value\"\n",
    "    )\n",
    "    .rename(columns={\n",
    "        \"Key Demographic aspects\": \"Indicator\",\n",
    "        \"Unit\": \"Measurement\"\n",
    "    })\n",
    ")\n",
    "\n",
    "# =============================================================\n",
    "# 4. FIX DTYPES\n",
    "# =============================================================\n",
    "df_long[\"Year\"] = df_long[\"Year\"].astype(int)\n",
    "df_long[\"Value\"] = pd.to_numeric(df_long[\"Value\"], errors=\"coerce\")\n",
    "\n",
    "# =============================================================\n",
    "# 5. CLEAN VALUES\n",
    "# =============================================================\n",
    "def clean_value(row):\n",
    "    if pd.isna(row[\"Value\"]):\n",
    "        return 0\n",
    "    if row[\"Measurement\"] == \"Absolute\":\n",
    "        return int(row[\"Value\"])\n",
    "    else:\n",
    "        return float(row[\"Value\"])\n",
    "\n",
    "df_long[\"Value\"] = df_long.apply(clean_value, axis=1)\n",
    "\n",
    "# =============================================================\n",
    "# 6. SPLIT INTO SUBSETS\n",
    "# =============================================================\n",
    "headcount_indicators = [\"Males\", \"Females\", \"Total population\"]\n",
    "\n",
    "df_counts = df_long[df_long[\"Indicator\"].isin(headcount_indicators)].copy()\n",
    "df_counts[\"Value\"] = df_counts[\"Value\"].round(0).astype(\"Int64\")\n",
    "\n",
    "df_relative = df_long[~df_long[\"Indicator\"].isin(headcount_indicators)].copy()\n",
    "\n",
    "# =============================================================\n",
    "# 7. INSPECT\n",
    "# =============================================================\n",
    "print(\"── df_long ──\")\n",
    "print(df_long)\n",
    "\n",
    "print(\"\\n── df_counts (headcounts only) ──\")\n",
    "print(df_counts)\n",
    "\n",
    "print(\"\\n── df_relative (ratios, density, etc.) ──\")\n",
    "print(df_relative)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b3f95c1a-878f-4ed1-a305-6122bbf9ad77",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
